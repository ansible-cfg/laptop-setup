- name: Downloads Helm source from GitHub
  unarchive:
    src: https://storage.googleapis.com/kubernetes-helm/helm-v2.7.2-linux-amd64.tar.gz
    remote_src: true
    dest: "{{setup_dir}}"
    extra_opts: ['--strip-components=1']

- name: Copy helm binary to bin dir
  copy:
    src: "{{setup_dir}}/helm"
    dest: /usr/local/bin/helm
    mode: a+x
  become: true

- name: Enable Helm autocompletions
  blockinfile:
    path: "{{ansible_env.HOME}}/.zshrc"
    block: |
      # Enable Helm autocompletion
      if [ -x "$(command -v helm)" ]; then
        source <(helm completion zsh)
      fi